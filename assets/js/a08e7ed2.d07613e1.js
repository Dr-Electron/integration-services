"use strict";(self.webpackChunkiota_wiki=self.webpackChunkiota_wiki||[]).push([[5114],{19983:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return d},default:function(){return u}});var o=t(83117),r=t(80102),i=(t(67294),t(3905)),a=["components"],l={},c=void 0,p={unversionedId:"contribution",id:"contribution",title:"contribution",description:"Local Development",source:"@site/external/integration-services/documentation/docs/contribution.md",sourceDirName:".",slug:"/contribution",permalink:"/integration-services/integration-services/contribution",tags:[],version:"current",frontMatter:{}},d=[{value:"Local Development",id:"local-development",children:[{value:"1. Run MongoDB",id:"1-run-mongodb",children:[],level:3},{value:"2. Run the API",id:"2-run-the-api",children:[],level:3}],level:2},{value:"3. Run all using Docker",id:"3-run-all-using-docker",children:[],level:2},{value:"4. API Key",id:"4-api-key",children:[],level:2}],s={toc:d};function u(e){var n=e.components,t=(0,r.Z)(e,a);return(0,i.kt)("wrapper",(0,o.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"local-development"},"Local Development"),(0,i.kt)("p",null,"For local development you can start the main service with docker-compose (as before) and then use nodejs to run the api:\nremember however to define the correct ",(0,i.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," environment variable changing ",(0,i.kt)("inlineCode",{parentName:"p"},"mongo")," with ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost"),"."),(0,i.kt)("h3",{id:"1-run-mongodb"},"1. Run MongoDB"),(0,i.kt)("p",null,"1.1  Change the directory to the ",(0,i.kt)("inlineCode",{parentName:"p"},"/api")," folder und use the following command: ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose up -d mongodb_container")," only the mongodb will be started using docker."),(0,i.kt)("p",null,"1.2. Check the docker container\nUse ",(0,i.kt)("inlineCode",{parentName:"p"},"docker ps")," to check whether the container is running. It should output something like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                      NAMES\neceaab9343eb   mongo:latest   "docker-entrypoint.s\u2026"   7 seconds ago   Up 7 seconds   0.0.0.0:27017->27017/tcp   api_mongodb_1\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"You can connect to the api via clients like ",(0,i.kt)("inlineCode",{parentName:"p"},"MongoDB Compass")," by using the defined connection url of the database like for instance ",(0,i.kt)("inlineCode",{parentName:"p"},"mongodb://root:rootpassword@0.0.0.0:27017"),"!")),(0,i.kt)("h3",{id:"2-run-the-api"},"2. Run the API"),(0,i.kt)("p",null,"2.1. Make sure you are in the ",(0,i.kt)("inlineCode",{parentName:"p"},"/api")," folder and use the following commands:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"npm install     # Install dependencies\nnpm run keygen  # Generate root identity: output on SERVER_ENTITY file\nnpm run start   # Run server\n")),(0,i.kt)("p",null,"If it was the first time the api is started, no ",(0,i.kt)("inlineCode",{parentName:"p"},"SERVER_IDENTITY")," is defined since it was left blank previously. The api should log a newly generated identity id which needs to be used as server identity as following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Successfully connected to mongodb\nCreate identity...\n==================================================================================================\n== Store this identity in the as ENV var: did:iota:BfGtLdthmzrUdgYptrZgnC4amXZBZ2C2xQMVM7Bb1cZs ==\n==================================================================================================\nAdd server id as trusted root...\nGenerate key collection...\nSet server identity as verified...\nSetup Done!\nPlease store the generated server identity as environment variable.\nLike: SERVER_IDENTITY=did:iota:BfGtLdthmzrUdgYptrZgnC4amXZBZ2C2xQMVM7Bb1cZs\n")),(0,i.kt)("p",null,"2.2. Copy the ",(0,i.kt)("inlineCode",{parentName:"p"},"SERVER_IDENTITY")," into the .env file."),(0,i.kt)("p",null,"2.3. Run the api again using ",(0,i.kt)("inlineCode",{parentName:"p"},"npm run start")),(0,i.kt)("p",null,"It should log that the api was started like following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Started API Server on port 3000\nSuccessfully connected to mongodb\n")),(0,i.kt)("h2",{id:"3-run-all-using-docker"},"3. Run all using Docker"),(0,i.kt)("p",null,"3.1. Start the api"),(0,i.kt)("p",null,"The api can also be run using docker therefor use the following command:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose up -d")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"!! Make sure the correct ip for the mongodb is set so the docker instance of the api is able to find the mongodb instance. Normally it should be the ip of the machine instaed of 0.0.0.0 !!")),(0,i.kt)("p",null,"If it was the first time the api is started, no ",(0,i.kt)("inlineCode",{parentName:"p"},"SERVER_IDENTITY")," is defined since it was left blank previously. The api should log a newly generated identity id which needs to be used as server identity as following:"),(0,i.kt)("p",null,"You can check the logs using: ",(0,i.kt)("inlineCode",{parentName:"p"},"docker logs api_ensuresec_api_1")," or using the container id like ",(0,i.kt)("inlineCode",{parentName:"p"},"docker logs <container-id>")," by replacing ",(0,i.kt)("inlineCode",{parentName:"p"},"<container-id>")," with the actual id."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Successfully connected to mongodb\nCreate identity...\n==================================================================================================\n== Store this identity in the as ENV var: did:iota:BfGtLdthmzrUdgYptrZgnC4amXZBZ2C2xQMVM7Bb1cZs ==\n==================================================================================================\nAdd server id as trusted root...\nGenerate key collection...\nSet server identity as verified...\nSetup Done!\nPlease store the generated server identity as environment variable.\nLike: SERVER_IDENTITY=did:iota:BfGtLdthmzrUdgYptrZgnC4amXZBZ2C2xQMVM7Bb1cZs\n")),(0,i.kt)("p",null,"3.2. Copy the ",(0,i.kt)("inlineCode",{parentName:"p"},"SERVER_IDENTITY")," into the .env file."),(0,i.kt)("p",null,"3.3. Run the docker again using ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose up -d")),(0,i.kt)("p",null,"The docker container should log that the api was started like following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Started API Server on port 3000\nSuccessfully connected to mongodb\n")),(0,i.kt)("p",null,"There should be now 2 docker container available check it using: `docker ps``"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'CONTAINER ID   IMAGE               COMMAND                  CREATED         STATUS         PORTS                      NAMES\n086e1549bdb3   api_ensuresec_api   "docker-entrypoint.s\u2026"   6 seconds ago   Up 5 seconds   0.0.0.0:3000->3000/tcp     api_ensuresec_api_1\n0bd35f3d5fc5   mongo:latest        "docker-entrypoint.s\u2026"   7 seconds ago   Up 6 seconds   0.0.0.0:27017->27017/tcp   api_mongodb_container_1\n')),(0,i.kt)("h2",{id:"4-api-key"},"4. API Key"),(0,i.kt)("p",null,"The api supports an optional api-key which can be used to filter requests which do not know about the right key. If the key is not added or is set as an empty string the api-key won't be considered by the api. To force a check for the api-key it can be added by adding the env variable ",(0,i.kt)("inlineCode",{parentName:"p"},"API_KEY")," to the .env file, like for instance:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"API_KEY=SAMPLE-API-KEY\n")),(0,i.kt)("p",null,"In this case all request must have the specified api-key as ",(0,i.kt)("inlineCode",{parentName:"p"},"?api-key=SAMPLE-API-KEY")," query parameter like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"localhost:3000/api/v1/verification/latest-document/did:iota:2k7Spwr9yFfCTgGPArucUg3h89W6kidjqBBMMKMW4C9r?api-key=SAMPLE-API-KEY\n")))}u.isMDXComponent=!0},3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return k}});var o=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=o.createContext({}),p=function(e){var n=o.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},d=function(e){var n=p(e.components);return o.createElement(c.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},u=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(t),k=r,h=u["".concat(c,".").concat(k)]||u[k]||s[k]||i;return t?o.createElement(h,a(a({ref:n},d),{},{components:t})):o.createElement(h,a({ref:n},d))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,a=new Array(i);a[0]=u;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var p=2;p<i;p++)a[p]=t[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);